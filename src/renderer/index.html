<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>MG AFK</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=Sora:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="loader" id="appLoader">
      <div class="loader-spinner"></div>
      <span class="loader-text">Loading...</span>
    </div>
    <main class="app">
      <div class="main-layout" id="mainView">
        <div class="top-bar">
          <header class="hero">
            <h1>Stay in Magic Garden, hands free</h1>
            <p>
              Connect to a room, stay online, and track ability triggers in real
              time.
            </p>
          </header>
          <div class="top-actions">
            <select id="openGameSelect" class="top-select small" aria-label="Game site">
              <option value="https://magicgarden.gg">magicgarden.gg</option>
              <option value="https://starweaver.org">starweaver.org</option>
              <option value="https://magiccircle.gg">magiccircle.gg</option>
            </select>
            <button id="openGameBtn" class="secondary small">Open game</button>
            <button id="toggleDevBtn" class="secondary small">Dev panel</button>
            <button id="checkUpdateBtn" class="secondary small">Check update</button>
            <button id="openUpdateBtn" class="secondary small hidden">Download</button>
            <span id="updateStatus" class="hint"></span>
          </div>
        </div>

        <div class="tabs-bar">
          <div id="tabs" class="tabs">
            <button id="addTabBtn" class="tab tab-add">+</button>
          </div>
        </div>

        <section class="card form-card">
          <div class="card-title">
            <h2>Connection</h2>
            <span id="statusChip" class="chip chip-idle">Offline</span>
          </div>
          <div class="form-grid">
            <div class="field-inline">
              <span>Account</span>
              <div class="cookie-field-row">
                <input id="cookieInput" type="hidden" />
<button id="loginBtn" class="login-btn" type="button" title="Log in with Discord">Login</button>
                <button id="logoutBtn" class="login-btn logout-btn hidden" type="button" title="Log out and clear session">Logout</button>
              </div>
            </div>
            <label class="field-inline">
              <span>Room code (optional)</span>
              <input id="roomInput" type="text" placeholder="Auto room" />
            </label>
          </div>
          <div class="reconnect">
            <details class="reconnect-details">
              <summary class="label">Reconnect on</summary>
              <div class="reconnect-body">
                <div class="reconnect-cards">
                  <div class="reconnect-card">
                    <div class="reconnect-card-header">
                      <span class="reconnect-card-title">Superseded</span>
                      <input
                        type="checkbox"
                        data-group="superseded"
                        aria-label="Reconnect on superseded"
                      />
                    </div>
                    <span class="reconnect-card-desc">
                      Reconnect if another device/session takes over.
                    </span>
                    <div class="reconnect-delay">
                      <span class="label">Delay</span>
                      <input
                        id="reconnectDelaySuperseded"
                        class="reconnect-range"
                        type="range"
                        min="10"
                        max="60"
                        step="1"
                        data-delay-group="superseded"
                      />
                      <span id="reconnectDelaySupersededValue" class="value mono">0s</span>
                    </div>
                  </div>
                  <div class="reconnect-card">
                    <div class="reconnect-card-header">
                      <span class="reconnect-card-title">Other disconnects</span>
                      <input
                        type="checkbox"
                        data-group="other"
                        data-unknown="true"
                        aria-label="Reconnect on other disconnects"
                      />
                    </div>
                    <span class="reconnect-card-desc">
                      Reconnect on game updates, timeouts, kicks, auth errors, or unknown drops.
                    </span>
                    <div class="reconnect-delay">
                      <span class="label">Delay</span>
                      <input
                        id="reconnectDelayOther"
                        class="reconnect-range"
                        type="range"
                        min="0"
                        max="10"
                        step="1"
                        data-delay-group="other"
                      />
                      <span id="reconnectDelayOtherValue" class="value mono">0s</span>
                    </div>
                  </div>
                </div>
              </div>
            </details>
          </div>
          <div class="connect-row">
            <button id="toggleBtn" class="primary">Connect</button>
          </div>
          <div class="actions">
            <span id="errorText" class="error"></span>
            <span id="reconnectCountdown" class="hint"></span>
          </div>
        </section>

        <section class="stack-column" id="stackColumn">
          <div class="card logs-card" id="logsCard">
            <div class="logs-header">
              <h3>Ability logs</h3>
            </div>
            <div class="logs-controls">
              <input
                id="logSearchInput"
                class="log-search"
                type="search"
                placeholder="Search logs..."
                aria-label="Search ability logs"
              />
            </div>
            <div id="logList" class="logs"></div>
          </div>
          <div class="card pet-card" id="petCard">
            <h3>Pet hunger</h3>
            <div id="petList" class="pet-list"></div>
          </div>
        </section>

        <section class="grid compact-grid">
          <div class="card status-card" id="statusCard">
            <h3>Live status</h3>
            <div class="stat">
              <span class="label">Players online</span>
              <span id="playersValue" class="value">0</span>
            </div>
            <div class="stat">
              <span class="label">Uptime</span>
              <span id="uptimeValue" class="value">00:00:00</span>
            </div>
            <div class="stat">
              <span class="label">Player</span>
              <span id="playerNameValue" class="value">-</span>
            </div>
            <div class="stat">
              <span class="label">Room</span>
              <span id="roomIdValue" class="value mono">-</span>
            </div>
            <div class="stat">
              <span class="label">Weather</span>
              <span class="value weather-value">
                <img
                  id="weatherIcon"
                  class="item-sprite sprite-placeholder weather-sprite"
                  alt=""
                  loading="lazy"
                  decoding="async"
                />
                <span id="weatherValue">-</span>
              </span>
            </div>
            <div class="stat">
              <span class="label">Player ID</span>
              <span id="playerIdValue" class="value mono">-</span>
            </div>
          </div>
        </section>

        <div class="shops-column" id="shopsColumn">
          <section class="card shops-card" id="shopsCard">
            <h3>Shop restock</h3>
            <div class="shops-grid">
              <div class="shop-block">
                <div class="shop-header">
                  <h4>Seeds</h4>
                  <span id="shopSeedRestock" class="shop-restock">--:--</span>
                </div>
                <div id="shopSeedList" class="shop-list"></div>
              </div>
              <div class="shop-block">
                <div class="shop-header">
                  <h4>Tools</h4>
                  <span id="shopToolRestock" class="shop-restock">--:--</span>
                </div>
                <div id="shopToolList" class="shop-list"></div>
              </div>
              <div class="shop-block">
                <div class="shop-header">
                  <h4>Eggs</h4>
                  <span id="shopEggRestock" class="shop-restock">--:--</span>
                </div>
                <div id="shopEggList" class="shop-list"></div>
              </div>
              <div class="shop-block">
                <div class="shop-header">
                  <h4>Decors</h4>
                  <span id="shopDecorRestock" class="shop-restock">--:--</span>
                </div>
                <div id="shopDecorList" class="shop-list"></div>
              </div>
            </div>
          </section>
          <section class="card alerts-card" id="alertsCard">
            <div class="alerts-header">
              <h3>Alerts</h3>
            </div>
            <div class="alerts-controls">
            <select
              id="alertShopSelect"
              class="top-select alert-select"
              aria-label="Shop filter"
            >
              <option value="seed">Seeds</option>
              <option value="tool">Tools</option>
              <option value="egg">Eggs</option>
              <option value="decor">Decors</option>
              <option value="pet">Pet</option>
              <option value="weather">Weather</option>
            </select>
            <select
              id="alertNotifySelect"
              class="top-select alert-mode"
              aria-label="Alert notifications"
            >
              <option value="windows">Windows notification</option>
              <option value="sound">Sound only</option>
            </select>
          </div>
            <div class="alerts-table">
              <div class="alerts-row alerts-head">
                <span class="alerts-cell">Item</span>
                <span class="alerts-cell">Notify</span>
              </div>
              <div id="alertRows" class="alerts-rows"></div>
            </div>
          </section>
        </div>

      </div>

      <section class="dev-view hidden" id="devView">
        <div class="dev-top">
          <h2>Dev tools</h2>
          <button id="devBackBtn" class="secondary small">Back</button>
        </div>
        <section class="card dev-card">
          <div class="dev-stack">
            <div class="dev-block">
              <div class="dev-block-header">
                <h4>WS traffic</h4>
                <div class="dev-block-actions">
                  <input
                    id="trafficSearchInput"
                    class="dev-search"
                    type="search"
                    placeholder="Search traffic..."
                    aria-label="Search websocket traffic"
                  />
                  <button id="trafficCopyAllBtn" class="dev-action-btn" title="Export all traffic to clipboard">Export</button>
                  <button id="trafficClearBtn" class="dev-action-btn" title="Clear traffic logs">Clear</button>
                </div>
              </div>
              <div id="trafficList" class="dev-list"></div>
            </div>
            <div class="dev-block">
              <div class="dev-block-header">
                <h4>Connection logs</h4>
                <div class="dev-block-actions">
                  <input
                    id="connSearchInput"
                    class="dev-search"
                    type="search"
                    placeholder="Search connections..."
                    aria-label="Search connection logs"
                  />
                  <button id="connCopyAllBtn" class="dev-action-btn" title="Export all connection logs to clipboard">Export</button>
                  <button id="connClearBtn" class="dev-action-btn" title="Clear connection logs">Clear</button>
                </div>
              </div>
              <div id="connList" class="dev-list"></div>
            </div>
          </div>
        </section>
      </section>
    </main>

    <script src="sprites.js"></script>
    <script src="shops.js"></script>
    <script type="module" src="renderer.js"></script>
  </body>
</html>
